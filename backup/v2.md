```yaml
name: absensi_guru
description: A Flutter app for teacher attendance with selfie and GPS.

publish_to: 'none'

version: 1.0.0+1

environment:
  sdk: '>=3.0.0 <4.0.0'

dependencies:
  flutter:
    sdk: flutter
  camera: ^0.11.0+2
  geolocator: ^13.0.1
  permission_handler: ^11.3.1
  path_provider: ^2.1.5
  sqflite: ^2.4.0
  sqflite_common_ffi: ^2.3.2
  image_picker: ^1.1.2
  intl: ^0.19.0
  path: ^1.8.3
  csv: ^5.0.2  # For CSV export
  google_maps_flutter: ^2.5.3  # For maps

dev_dependencies:
  flutter_test:
    sdk: flutter
  flutter_lints: ^2.0.0

flutter:
  uses-material-design: true
```

```dart
// lib/main.dart
import 'package:flutter/material.dart';
import 'package:permission_handler/permission_handler.dart';
import 'screens/login_page.dart';
import 'services/db_helper.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await DBHelper.initDB();
  // Seed data if needed (call once)
  await _seedData();
  runApp(const MyApp());
}

Future<void> _seedData() async {
  final dbHelper = DBHelper();
  // Check if super_admin exists, if not insert
  final superAdminCount = Sqflite.firstIntValue(
    await dbHelper.database.query('users', where: 'username = ?', whereArgs: ['super'])
  );
  if (superAdminCount == null || superAdminCount == 0) {
    await dbHelper.insertUser({
      'username': 'super',
      'password': 'admin123', // Note: For POC only; use hashing in production
      'name': 'Super Admin',
      'role': 'super_admin',
      'type': 'pns',
      'nip': '1234567890',
      'npwp': '0000000000',
      'created_at': DateTime.now().toIso8601String(),
      'updated_at': DateTime.now().toIso8601String(),
    });
  }

  // Admin
  final adminCount = Sqflite.firstIntValue(
    await dbHelper.database.query('users', where: 'username = ?', whereArgs: ['admin'])
  );
  if (adminCount == null || adminCount == 0) {
    await dbHelper.insertUser({
      'username': 'admin',
      'password': 'admin123',
      'name': 'Admin',
      'role': 'admin',
      'type': 'pns',
      'nip': '0987654321',
      'npwp': '1111111111',
      'created_at': DateTime.now().toIso8601String(),
      'updated_at': DateTime.now().toIso8601String(),
    });
  }

  // Guru 1
  final guru1Count = Sqflite.firstIntValue(
    await dbHelper.database.query('users', where: 'username = ?', whereArgs: ['guru1'])
  );
  if (guru1Count == null || guru1Count == 0) {
    await dbHelper.insertUser({
      'username': 'guru1',
      'password': 'guru123',
      'name': 'Guru Satu',
      'role': 'guru',
      'type': 'pns',
      'nip': '1111111111',
      'npwp': '2222222222',
      'created_at': DateTime.now().toIso8601String(),
      'updated_at': DateTime.now().toIso8601String(),
    });
  }

  // Guru 2 non-PNS
  final guru2Count = Sqflite.firstIntValue(
    await dbHelper.database.query('users', where: 'username = ?', whereArgs: ['guru2'])
  );
  if (guru2Count == null || guru2Count == 0) {
    await dbHelper.insertUser({
      'username': 'guru2',
      'password': 'guru123',
      'name': 'Guru Dua',
      'role': 'guru',
      'type': 'non_pns',
      'nip': null,
      'npwp': null,
      'created_at': DateTime.now().toIso8601String(),
      'updated_at': DateTime.now().toIso8601String(),
    });
  }

  // Initial settings
  await dbHelper.insertOrUpdateSetting('center_lat', '-7.797068');
  await dbHelper.insertOrUpdateSetting('center_lng', '110.370529');
  await dbHelper.insertOrUpdateSetting('max_distance_m', '1000');
}

class MyApp extends StatelessWidget {
  const MyApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Absensi Guru',
      theme: ThemeData(
        primarySwatch: Colors.blue,
        visualDensity: VisualDensity.adaptivePlatformDensity,
        appBarTheme: const AppBarTheme(
          backgroundColor: Colors.blue,
          foregroundColor: Colors.white,
          elevation: 0,
        ),
        cardTheme: CardTheme(
          elevation: 4,
          shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(12)),
        ),
      ),
      home: const LoginPage(),
    );
  }
}
```

```dart
// lib/models/user.dart
class User {
  final int? id;
  final String username;
  final String password; // Note: Plaintext for POC; hash in production
  final String name;
  final String role; // super_admin, admin, guru
  final String type; // pns, non_pns
  final String? nip;
  final String? npwp;
  final DateTime createdAt;
  final DateTime updatedAt;

  User({
    this.id,
    required this.username,
    required this.password,
    required this.name,
    required this.role,
    required this.type,
    this.nip,
    this.npwp,
    required this.createdAt,
    required this.updatedAt,
  });

  factory User.fromMap(Map<String, dynamic> map) {
    return User(
      id: map['id'],
      username: map['username'],
      password: map['password'],
      name: map['name'],
      role: map['role'],
      type: map['type'],
      nip: map['nip'],
      npwp: map['npwp'],
      createdAt: DateTime.parse(map['created_at']),
      updatedAt: DateTime.parse(map['updated_at']),
    );
  }

  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'username': username,
      'password': password,
      'name': name,
      'role': role,
      'type': type,
      'nip': nip,
      'npwp': npwp,
      'created_at': createdAt.toIso8601String(),
      'updated_at': updatedAt.toIso8601String(),
    };
  }
}
```

```dart
// lib/models/attendance.dart
class Attendance {
  final int? id;
  final int userId;
  final String date; // yyyy-MM-dd
  final String type; // check_in, check_out
  final String time; // HH:mm:ss
  final String photoPath;
  final double latitude;
  final double longitude;
  final double distanceM;
  final String status; // pending, validated, rejected
  final String? userComment; // New field for user description/note
  final String? adminComment;
  final int? validatedBy;
  final DateTime createdAt;
  final DateTime updatedAt;

  Attendance({
    this.id,
    required this.userId,
    required this.date,
    required this.type,
    required this.time,
    required this.photoPath,
    required this.latitude,
    required this.longitude,
    required this.distanceM,
    required this.status,
    this.userComment,
    this.adminComment,
    this.validatedBy,
    required this.createdAt,
    required this.updatedAt,
  });

  factory Attendance.fromMap(Map<String, dynamic> map) {
    return Attendance(
      id: map['id'],
      userId: map['user_id'],
      date: map['date'],
      type: map['type'],
      time: map['time'],
      photoPath: map['photo_path'],
      latitude: map['latitude'],
      longitude: map['longitude'],
      distanceM: map['distance_m'],
      status: map['status'],
      userComment: map['user_comment'],
      adminComment: map['admin_comment'],
      validatedBy: map['validated_by'],
      createdAt: DateTime.parse(map['created_at']),
      updatedAt: DateTime.parse(map['updated_at']),
    );
  }

  Map<String, dynamic> toMap() {
    return {
      'id': id,
      'user_id': userId,
      'date': date,
      'type': type,
      'time': time,
      'photo_path': photoPath,
      'latitude': latitude,
      'longitude': longitude,
      'distance_m': distanceM,
      'status': status,
      'user_comment': userComment,
      'admin_comment': adminComment,
      'validated_by': validatedBy,
      'created_at': createdAt.toIso8601String(),
      'updated_at': updatedAt.toIso8601String(),
    };
  }
}
```

```dart
// lib/services/db_helper.dart
import 'dart:io';
import 'package:path/path.dart';
import 'package:sqflite/sqflite.dart';
import 'package:sqflite_common_ffi/sqflite_ffi.dart';
import 'package:path_provider/path_provider.dart';
import '../models/user.dart';
import '../models/attendance.dart';

class DBHelper {
  static Database? _database;
  static final DBHelper instance = DBHelper._init();
  DBHelper._init();

  Future<Database> get database async {
    if (_database != null) return _database!;
    _database = await _initDB('absensi_guru.db');
    return _database!;
  }

  static Future<Database> _initDB(String filePath) async {
    // Initialize FFI for desktop
    if (Platform.isWindows || Platform.isLinux || Platform.isMacOS) {
      sqfliteFfiInit();
      databaseFactory = databaseFactoryFfi;
    }

    String path;
    if (Platform.isAndroid) {
      path = '/databases/$filePath';
    } else {
      Directory documentsDirectory = await getApplicationDocumentsDirectory();
      path = join(documentsDirectory.path, filePath);
    }

    return await openDatabase(path, version: 2, onCreate: _createDB, onUpgrade: _onUpgrade);
  }

  static Future _createDB(Database db, int version) async {
    // Users table
    await db.execute('''
    CREATE TABLE users (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      username TEXT UNIQUE NOT NULL,
      password TEXT NOT NULL,
      name TEXT NOT NULL,
      role TEXT NOT NULL CHECK(role IN ('super_admin','admin','guru')),
      type TEXT CHECK(type IN ('pns','non_pns')) DEFAULT 'non_pns',
      nip TEXT,
      npwp TEXT,
      created_at TEXT NOT NULL,
      updated_at TEXT NOT NULL
    )
    ''');

    // Attendance table - Updated with user_comment
    await db.execute('''
    CREATE TABLE attendance (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      user_id INTEGER NOT NULL REFERENCES users(id),
      date TEXT NOT NULL,
      type TEXT NOT NULL CHECK(type IN ('check_in','check_out')),
      time TEXT NOT NULL,
      photo_path TEXT NOT NULL,
      latitude REAL NOT NULL,
      longitude REAL NOT NULL,
      distance_m REAL NOT NULL,
      status TEXT NOT NULL CHECK(status IN ('pending','validated','rejected')) DEFAULT 'pending',
      user_comment TEXT,
      admin_comment TEXT,
      validated_by INTEGER,
      created_at TEXT NOT NULL,
      updated_at TEXT NOT NULL
    )
    ''');

    // Settings table
    await db.execute('''
    CREATE TABLE settings (
      id INTEGER PRIMARY KEY AUTOINCREMENT,
      key TEXT UNIQUE NOT NULL,
      value TEXT NOT NULL
    )
    ''');
  }

  // Migration for existing DBs
  static Future<void> _onUpgrade(Database db, int oldVersion, int newVersion) async {
    if (oldVersion < 2) {
      await db.execute('ALTER TABLE attendance ADD COLUMN user_comment TEXT');
    }
  }

  static Future<void> initDB() async {
    await instance.database;
  }

  Future<int> insertUser(Map<String, dynamic> userMap) async {
    final db = await database;
    return await db.insert('users', userMap);
  }

  Future<User?> getUserByUsername(String username) async {
    final db = await database;
    final maps = await db.query(
      'users',
      where: 'username = ?',
      whereArgs: [username],
    );
    if (maps.isNotEmpty) {
      return User.fromMap(maps.first);
    }
    return null;
  }

  Future<List<User>> getAllUsers() async {
    final db = await database;
    final List<Map<String, dynamic>> maps = await db.query('users');
    return List.generate(maps.length, (i) => User.fromMap(maps[i]));
  }

  Future<int> updateUser(User user) async {
    final db = await database;
    return await db.update(
      'users',
      user.toMap(),
      where: 'id = ?',
      whereArgs: [user.id],
    );
  }

  Future<int> deleteUser(int id) async {
    final db = await database;
    return await db.delete(
      'users',
      where: 'id = ?',
      whereArgs: [id],
    );
  }

  // Attendance CRUD
  Future<int> insertAttendance(Map<String, dynamic> attMap) async {
    final db = await database;
    return await db.insert('attendance', attMap);
  }

  Future<List<Attendance>> getPendingAttendances() async {
    final db = await database;
    final List<Map<String, dynamic>> maps = await db.query(
      'attendance',
      where: 'status = ?',
      whereArgs: ['pending'],
      orderBy: 'date DESC, time ASC',
    );
    return List.generate(maps.length, (i) => Attendance.fromMap(maps[i]));
  }

  Future<Attendance?> getAttendance(int id) async {
    final db = await database;
    final maps = await db.query(
      'attendance',
      where: 'id = ?',
      whereArgs: [id],
    );
    if (maps.isNotEmpty) {
      return Attendance.fromMap(maps.first);
    }
    return null;
  }

  Future<List<Attendance>> getUserAttendances(int userId, {String? date}) async {
    final db = await database;
    List<String> whereArgs = [userId.toString()];
    String whereClause = 'user_id = ?';
    if (date != null) {
      whereClause += ' AND date = ?';
      whereArgs.add(date);
    }
    final List<Map<String, dynamic>> maps = await db.query(
      'attendance',
      where: whereClause,
      whereArgs: whereArgs,
      orderBy: 'date DESC, time ASC',
    );
    return List.generate(maps.length, (i) => Attendance.fromMap(maps[i]));
  }

  Future<int> updateAttendance(Attendance attendance) async {
    final db = await database;
    return await db.update(
      'attendance',
      attendance.toMap(),
      where: 'id = ?',
      whereArgs: [attendance.id],
    );
  }

  // Settings
  Future<void> insertOrUpdateSetting(String key, String value) async {
    final db = await database;
    await db.insert('settings', {'key': key, 'value': value},
        conflictAlgorithm: ConflictAlgorithm.replace);
  }

  Future<String?> getSetting(String key) async {
    final db = await database;
    final maps = await db.query('settings', where: 'key = ?', whereArgs: [key]);
    if (maps.isNotEmpty) {
      return maps.first['value'];
    }
    return null;
  }
}
```

```dart
// lib/services/auth_service.dart
import '../models/user.dart';
import 'db_helper.dart';

class AuthService {
  static User? _currentUser;

  static Future<bool> login(String username, String password) async {
    final dbHelper = DBHelper();
    final user = await dbHelper.getUserByUsername(username);
    if (user != null && user.password == password) { // Plaintext for POC
      _currentUser = user;
      return true;
    }
    return false;
  }

  static User? get currentUser => _currentUser;

  static void logout() {
    _currentUser = null;
  }

  static bool isSuperAdmin() => _currentUser?.role == 'super_admin';
  static bool isAdmin() => _currentUser?.role == 'admin';
  static bool isGuru() => _currentUser?.role == 'guru';
}
```

```dart
// lib/services/location_service.dart
import 'dart:math';
import 'package:geolocator/geolocator.dart';
import 'package:permission_handler/permission_handler.dart';
import 'db_helper.dart';

class LocationService {
  // Haversine formula to calculate distance
  static double calculateDistance(double lat1, double lon1, double lat2, double lon2) {
    const double earthRadius = 6371000; // meters
    double dLat = (lat2 - lat1) * pi / 180;
    double dLon = (lon2 - lon1) * pi / 180;
    double a = sin(dLat / 2) * sin(dLat / 2) +
        cos(lat1 * pi / 180) * cos(lat2 * pi / 180) * sin(dLon / 2) * sin(dLon / 2);
    double c = 2 * atan2(sqrt(a), sqrt(1 - a));
    return earthRadius * c;
  }

  static Future<bool> requestPermissions() async {
    final cameraStatus = await Permission.camera.request();
    final locationStatus = await Permission.location.request();
    return cameraStatus.isGranted && locationStatus.isGranted;
  }

  static Future<Position?> getCurrentPosition() async {
    bool serviceEnabled = await Geolocator.isLocationServiceEnabled();
    if (!serviceEnabled) {
      return null;
    }

    LocationPermission permission = await Geolocator.checkPermission();
    if (permission == LocationPermission.denied) {
      permission = await Geolocator.requestPermission();
      if (permission == LocationPermission.denied) {
        return null;
      }
    }

    if (permission == LocationPermission.deniedForever) {
      return null;
    }

    return await Geolocator.getCurrentPosition(desiredAccuracy: LocationAccuracy.high);
  }

  static Future<bool> isWithinRadius(double lat, double lng) async {
    final dbHelper = DBHelper();
    final centerLatStr = await dbHelper.getSetting('center_lat');
    final centerLngStr = await dbHelper.getSetting('center_lng');
    final maxDistStr = await dbHelper.getSetting('max_distance_m');

    if (centerLatStr == null || centerLngStr == null || maxDistStr == null) {
      return false;
    }

    final centerLat = double.parse(centerLatStr);
    final centerLng = double.parse(centerLngStr);
    final maxDist = double.parse(maxDistStr);

    final distance = calculateDistance(centerLat, centerLng, lat, lng);
    return distance <= maxDist;
  }

  static Future<Map<String, double>> getCenterLocation() async {
    final dbHelper = DBHelper();
    final centerLatStr = await dbHelper.getSetting('center_lat');
    final centerLngStr = await dbHelper.getSetting('center_lng');
    if (centerLatStr == null || centerLngStr == null) {
      return {'lat': -7.797068, 'lng': 110.370529}; // default
    }
    return {
      'lat': double.parse(centerLatStr),
      'lng': double.parse(centerLngStr),
    };
  }
}
```

```dart
// lib/services/attendance_service.dart
import 'dart:io';
import 'package:intl/intl.dart';
import 'package:path_provider/path_provider.dart';
import 'package:image_picker/image_picker.dart';
import '../models/attendance.dart';
import 'db_helper.dart';
import 'location_service.dart';

class AttendanceService {
  static Future<String?> takeSelfie() async {
    final picker = ImagePicker();
    final XFile? image = await picker.pickImage(source: ImageSource.camera);
    if (image == null) return null;

    final directory = await getApplicationDocumentsDirectory();
    final fileName = 'selfie_${DateTime.now().millisecondsSinceEpoch}.jpg';
    final savedImage = await File(image.path).copy('${directory.path}/$fileName');
    return savedImage.path;
  }

  static Future<Attendance?> createAttendance(int userId, String type, String? userComment) async {
    // Check if already attended today for this type
    final dbHelper = DBHelper();
    final today = DateFormat('yyyy-MM-dd').format(DateTime.now());
    final existing = await dbHelper.getUserAttendances(userId, date: today);
    final alreadyDone = existing.any((att) => att.type == type && att.status == 'validated');
    if (alreadyDone) {
      throw Exception('Already attended $type today');
    }

    // Take selfie
    final photoPath = await takeSelfie();
    if (photoPath == null) {
      throw Exception('Failed to take selfie');
    }

    // Get location
    final position = await LocationService.getCurrentPosition();
    if (position == null) {
      throw Exception('Failed to get location');
    }

    final isWithin = await LocationService.isWithinRadius(position.latitude, position.longitude);
    if (!isWithin) {
      throw Exception('Outside allowed radius');
    }

    final distance = await _getDistanceToCenter(position.latitude, position.longitude);

    final now = DateTime.now();
    final attendance = Attendance(
      userId: userId,
      date: DateFormat('yyyy-MM-dd').format(now),
      type: type,
      time: DateFormat('HH:mm:ss').format(now),
      photoPath: photoPath,
      latitude: position.latitude,
      longitude: position.longitude,
      distanceM: distance,
      status: 'pending',
      userComment: userComment, // Include user comment
      createdAt: now,
      updatedAt: now,
    );

    final id = await dbHelper.insertAttendance(attendance.toMap());
    attendance.id = id;
    return attendance;
  }

  static Future<double> _getDistanceToCenter(double lat, double lng) async {
    final dbHelper = DBHelper();
    final centerLatStr = await dbHelper.getSetting('center_lat');
    final centerLngStr = await dbHelper.getSetting('center_lng');
    if (centerLatStr == null || centerLngStr == null) return 0.0;
    final centerLat = double.parse(centerLatStr);
    final centerLng = double.parse(centerLngStr);
    return LocationService.calculateDistance(centerLat, centerLng, lat, lng);
  }

  static Future<void> validateAttendance(int attendanceId, String status, String? comment, int adminId) async {
    if (status != 'validated' && status != 'rejected') {
      throw Exception('Invalid status');
    }
    final dbHelper = DBHelper();
    final attendance = await dbHelper.getAttendance(attendanceId);
    if (attendance == null) throw Exception('Attendance not found');

    attendance.status = status;
    attendance.adminComment = comment;
    attendance.validatedBy = adminId;
    attendance.updatedAt = DateTime.now();

    await dbHelper.updateAttendance(attendance);
  }
}
```

```dart
// lib/services/export_service.dart
import 'dart:io';
import 'package:intl/intl.dart';
import 'package:path_provider/path_provider.dart';
import 'package:csv/csv.dart';
import '../models/user.dart';
import 'db_helper.dart';

class ExportService {
  static Future<String> exportAttendanceToCsv({DateTime? startDate, DateTime? endDate}) async {
    final dbHelper = DBHelper();
    final now = DateTime.now();
    startDate ??= now.subtract(const Duration(days: 30));
    endDate ??= now;

    final startStr = DateFormat('yyyy-MM-dd').format(startDate);
    final endStr = DateFormat('yyyy-MM-dd').format(endDate);

    final attendances = await dbHelper.database.query(
      'attendance',
      where: 'date BETWEEN ? AND ?',
      whereArgs: [startStr, endStr],
      orderBy: 'date ASC, time ASC',
    );

    final users = await dbHelper.getAllUsers();
    final userMap = {for (var u in users) u.id: u};

    List<List<dynamic>> csvData = [
      ['Tanggal', 'Nama', 'NIP', 'Type', 'Waktu', 'Status', 'Jarak (m)', 'User Comment', 'Photo Path']
    ];

    for (var attMap in attendances) {
      final att = Attendance.fromMap(attMap);
      final user = userMap[att.userId];
      if (user == null) continue;

      csvData.add([
        att.date,
        user.name,
        user.nip ?? '',
        att.type,
        att.time,
        att.status,
        att.distanceM.toStringAsFixed(2),
        att.userComment ?? '',
        att.photoPath,
      ]);
    }

    String csv = const ListToCsvConverter().convert(csvData);

    final directory = await getExternalStorageDirectory();
    final path = '${directory?.path}/absensi_rekap_${DateFormat('yyyyMMdd').format(now)}.csv';
    final file = File(path ?? '${(await getApplicationDocumentsDirectory()).path}/absensi_rekap_${DateFormat('yyyyMMdd').format(now)}.csv');
    await file.writeAsString(csv);

    // Simple stats (you can expand)
    final validatedCount = attendances.where((a) => a['status'] == 'validated').length;
    print('Exported ${attendances.length} records, $validatedCount validated.'); // For now, print; can add to CSV

    return file.path;
  }
}
```

```dart
// lib/screens/login_page.dart
import 'package:flutter/material.dart';
import '../services/auth_service.dart';
import 'dashboard.dart';

class LoginPage extends StatefulWidget {
  const LoginPage({super.key});

  @override
  State<LoginPage> createState() => _LoginPageState();
}

class _LoginPageState extends State<LoginPage> {
  final _usernameController = TextEditingController();
  final _passwordController = TextEditingController();
  bool _isLoading = false;
  final _formKey = GlobalKey<FormState>();

  Future<void> _login() async {
    if (!_formKey.currentState!.validate()) return;
    setState(() => _isLoading = true);
    final success = await AuthService.login(_usernameController.text, _passwordController.text);
    if (success) {
      if (mounted) {
        Navigator.pushReplacement(
          context,
          MaterialPageRoute(builder: (context) => const Dashboard()),
        );
      }
    } else {
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(
          const SnackBar(content: Text('Login gagal. Periksa username dan password.'), backgroundColor: Colors.red),
        );
      }
    }
    setState(() => _isLoading = false);
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Container(
        decoration: const BoxDecoration(
          gradient: LinearGradient(
            begin: Alignment.topCenter,
            end: Alignment.bottomCenter,
            colors: [Colors.blue, Colors.blueAccent],
          ),
        ),
        child: SafeArea(
          child: Center(
            child: Padding(
              padding: const EdgeInsets.all(24.0),
              child: Card(
                child: Padding(
                  padding: const EdgeInsets.all(24.0),
                  child: Form(
                    key: _formKey,
                    child: Column(
                      mainAxisSize: MainAxisSize.min,
                      children: [
                        const Icon(Icons.school, size: 80, color: Colors.blue),
                        const SizedBox(height: 16),
                        const Text('Absensi Guru', style: TextStyle(fontSize: 24, fontWeight: FontWeight.bold)),
                        const SizedBox(height: 32),
                        TextFormField(
                          controller: _usernameController,
                          decoration: const InputDecoration(
                            labelText: 'Username',
                            prefixIcon: Icon(Icons.person),
                            border: OutlineInputBorder(borderRadius: BorderRadius.all(Radius.circular(8))),
                          ),
                          validator: (value) => value?.isEmpty ?? true ? 'Masukkan username' : null,
                        ),
                        const SizedBox(height: 16),
                        TextFormField(
                          controller: _passwordController,
                          decoration: const InputDecoration(
                            labelText: 'Password',
                            prefixIcon: Icon(Icons.lock),
                            border: OutlineInputBorder(borderRadius: BorderRadius.all(Radius.circular(8))),
                          ),
                          obscureText: true,
                          validator: (value) => value?.isEmpty ?? true ? 'Masukkan password' : null,
                        ),
                        const SizedBox(height: 24),
                        SizedBox(
                          width: double.infinity,
                          height: 50,
                          child: ElevatedButton(
                            onPressed: _isLoading ? null : _login,
                            style: ElevatedButton.styleFrom(
                              backgroundColor: Colors.blue,
                              shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(8)),
                            ),
                            child: _isLoading
                                ? const CircularProgressIndicator(color: Colors.white)
                                : const Text('Login', style: TextStyle(fontSize: 18)),
                          ),
                        ),
                      ],
                    ),
                  ),
                ),
              ),
            ),
          ),
        ),
      ),
    );
  }
}
```

```dart
// lib/screens/dashboard.dart
import 'package:flutter/material.dart';
import '../services/auth_service.dart';
import 'admin/pending_list.dart';
import 'guru/attendance_form.dart';
import 'super_admin/settings_page.dart';
import 'super_admin/manage_users.dart';

class Dashboard extends StatelessWidget {
  const Dashboard({super.key});

  @override
  Widget build(BuildContext context) {
    final userRole = AuthService.currentUser?.role;

    Widget body;
    switch (userRole) {
      case 'super_admin':
        body = const SuperAdminDashboard();
        break;
      case 'admin':
        body = const PendingListPage();
        break;
      case 'guru':
        body = const AttendanceForm();
        break;
      default:
        body = const Center(child: Text('Unknown role'));
    }

    return Scaffold(
      appBar: AppBar(
        title: Text('Dashboard - ${AuthService.currentUser?.name ?? ''}'),
        backgroundColor: Colors.blue,
        foregroundColor: Colors.white,
        actions: [
          IconButton(
            icon: const Icon(Icons.logout),
            onPressed: () {
              AuthService.logout();
              Navigator.pushReplacementNamed(context, '/login'); // Assume route, or push to LoginPage
              Navigator.pushReplacement(context, MaterialPageRoute(builder: (_) => const LoginPage()));
            },
          ),
        ],
      ),
      body: body,
    );
  }
}

class SuperAdminDashboard extends StatelessWidget {
  const SuperAdminDashboard({super.key});

  @override
  Widget build(BuildContext context) {
    return Padding(
      padding: const EdgeInsets.all(16.0),
      child: Column(
        children: [
          Card(
            child: ListTile(
              leading: const Icon(Icons.people, color: Colors.blue),
              title: const Text('Kelola Pengguna'),
              subtitle: const Text('Buat, edit, atau hapus akun pengguna'),
              trailing: const Icon(Icons.arrow_forward_ios),
              onTap: () => Navigator.push(context, MaterialPageRoute(builder: (_) => const ManageUsersPage())),
            ),
          ),
          const SizedBox(height: 16),
          Card(
            child: ListTile(
              leading: const Icon(Icons.settings, color: Colors.green),
              title: const Text('Pengaturan'),
              subtitle: const Text('Ubah lokasi pusat dan radius'),
              trailing: const Icon(Icons.arrow_forward_ios),
              onTap: () => Navigator.push(context, MaterialPageRoute(builder: (_) => const SettingsPage())),
            ),
          ),
          const SizedBox(height: 16),
          Card(
            child: ListTile(
              leading: const Icon(Icons.pending_actions, color: Colors.orange),
              title: const Text('Absensi Menunggu'),
              subtitle: const Text('Validasi absensi pending'),
              trailing: const Icon(Icons.arrow_forward_ios),
              onTap: () => Navigator.push(context, MaterialPageRoute(builder: (_) => const PendingListPage())),
            ),
          ),
        ],
      ),
    );
  }
}
```

```dart
// lib/screens/guru/attendance_form.dart
import 'package:flutter/material.dart';
import 'package:google_maps_flutter/google_maps_flutter.dart';
import 'package:intl/intl.dart';
import '../../services/auth_service.dart';
import '../../services/attendance_service.dart';
import '../../services/location_service.dart';
import '../../services/db_helper.dart';
import '../history_page.dart';

class AttendanceForm extends StatefulWidget {
  const AttendanceForm({super.key});

  @override
  State<AttendanceForm> createState() => _AttendanceFormState();
}

class _AttendanceFormState extends State<AttendanceForm> {
  bool _isLoading = false;
  String? _error;
  bool _canCheckIn = true;
  bool _canCheckOut = true;
  final _commentController = TextEditingController();
  String _selectedType = 'check_in';
  Position? _currentPosition;
  GoogleMapController? _mapController;
  Set<Marker> _markers = {};
  bool _showMap = false;

  @override
  void initState() {
    super.initState();
    _checkTodayAttendance();
    _requestPermissions();
  }

  Future<void> _requestPermissions() async {
    final granted = await LocationService.requestPermissions();
    if (!granted && mounted) {
      ScaffoldMessenger.of(context).showSnackBar(const SnackBar(content: Text('Permissions required for camera and location')));
    }
  }

  Future<void> _checkTodayAttendance() async {
    final userId = AuthService.currentUser!.id!;
    final dbHelper = DBHelper();
    final today = DateFormat('yyyy-MM-dd').format(DateTime.now());
    final attendances = await dbHelper.getUserAttendances(userId, date: today);
    final validatedIn = attendances.any((a) => a.type == 'check_in' && a.status == 'validated');
    final validatedOut = attendances.any((a) => a.type == 'check_out' && a.status == 'validated');
    if (mounted) {
      setState(() {
        _canCheckIn = !validatedIn;
        _canCheckOut = !validatedOut;
      });
    }
  }

  Future<void> _showLocationMap() async {
    final position = await LocationService.getCurrentPosition();
    if (position == null) {
      if (mounted) ScaffoldMessenger.of(context).showSnackBar(const SnackBar(content: Text('Gagal mendapatkan lokasi')));
      return;
    }
    final center = await LocationService.getCenterLocation();
    setState(() {
      _currentPosition = position;
      _markers = {
        Marker(
          markerId: const MarkerId('current'),
          position: LatLng(position.latitude, position.longitude),
          infoWindow: const InfoWindow(title: 'Lokasi Anda'),
          icon: BitmapDescriptor.defaultMarkerWithHue(BitmapDescriptor.hueRed),
        ),
        Marker(
          markerId: const MarkerId('center'),
          position: LatLng(center['lat']!, center['lng']!),
          infoWindow: const InfoWindow(title: 'Lokasi Pusat'),
          icon: BitmapDescriptor.defaultMarkerWithHue(BitmapDescriptor.hueBlue),
        ),
      };
      _showMap = true;
    });

    showDialog(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Konfirmasi Lokasi'),
        content: SizedBox(
          height: 300,
          child: GoogleMap(
            initialCameraPosition: CameraPosition(
              target: LatLng(position.latitude, position.longitude),
              zoom: 15,
            ),
            markers: _markers,
            onMapCreated: (controller) => _mapController = controller,
          ),
        ),
        actions: [
          TextButton(
            onPressed: () => Navigator.pop(context),
            child: const Text('Batal'),
          ),
          ElevatedButton(
            onPressed: () {
              Navigator.pop(context);
              _performAttendance(_selectedType);
            },
            child: const Text('Lanjut Absen'),
          ),
        ],
      ),
    );
  }

  Future<void> _performAttendance(String type) async {
    setState(() => _isLoading = true);
    try {
      await AttendanceService.createAttendance(
        AuthService.currentUser!.id!, 
        type, 
        _commentController.text.isEmpty ? null : _commentController.text
      );
      if (mounted) {
        ScaffoldMessenger.of(context).showSnackBar(SnackBar(content: Text('Absen $type berhasil dikirim (pending validasi)'), backgroundColor: Colors.green));
        _commentController.clear();
        _checkTodayAttendance();
      }
    } catch (e) {
      if (mounted) {
        setState(() => _error = e.toString());
        ScaffoldMessenger.of(context).showSnackBar(SnackBar(content: Text('Error: $e'), backgroundColor: Colors.red));
      }
    } finally {
      if (mounted) setState(() => _isLoading = false);
    }
  }

  @override
  Widget build(BuildContext context) {
    final isCheckIn = _selectedType == 'check_in';
    final canProceed = (isCheckIn && _canCheckIn) || (!isCheckIn && _canCheckOut);

    return Scaffold(
      appBar: AppBar(
        title: const Text('Absensi Harian'),
        backgroundColor: Colors.green,
        foregroundColor: Colors.white,
      ),
      body: Padding(
        padding: const EdgeInsets.all(16.0),
        child: Column(
          children: [
            Card(
              child: Padding(
                padding: const EdgeInsets.all(16.0),
                child: Column(
                  children: [
                    const Icon(Icons.access_time, size: 48, color: Colors.blue),
                    const SizedBox(height: 8),
                    Text(
                      DateFormat('EEEE, d MMMM yyyy').format(DateTime.now()),
                      style: const TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
                    ),
                  ],
                ),
              ),
            ),
            const SizedBox(height: 24),
            DropdownButtonFormField<String>(
              value: _selectedType,
              decoration: const InputDecoration(
                labelText: 'Jenis Absen',
                prefixIcon: Icon(Icons.login_outlined),
                border: OutlineInputBorder(),
              ),
              items: const [
                DropdownMenuItem(value: 'check_in', child: Text('Absen Masuk')),
                DropdownMenuItem(value: 'check_out', child: Text('Absen Pulang')),
              ],
              onChanged: (value) {
                if (value != null) {
                  setState(() => _selectedType = value);
                }
              },
            ),
            const SizedBox(height: 16),
            TextFormField(
              controller: _commentController,
              decoration: const InputDecoration(
                labelText: 'Keterangan (opsional)',
                hintText: 'Masukkan keterangan absen...',
                prefixIcon: Icon(Icons.note),
                border: OutlineInputBorder(),
              ),
              maxLines: 3,
            ),
            const SizedBox(height: 24),
            SizedBox(
              width: double.infinity,
              height: 50,
              child: ElevatedButton.icon(
                onPressed: _isLoading || !canProceed ? null : _showLocationMap,
                icon: Icon(isCheckIn ? Icons.login : Icons.logout),
                label: Text('Konfirmasi Lokasi & Absen ${isCheckIn ? 'Masuk' : 'Pulang'}'),
                style: ElevatedButton.styleFrom(
                  backgroundColor: isCheckIn ? Colors.green : Colors.orange,
                  shape: RoundedRectangleBorder(borderRadius: BorderRadius.circular(8)),
                ),
              ),
            ),
            if (_error != null) ...[
              const SizedBox(height: 16),
              Card(
                color: Colors.red.shade50,
                child: Padding(
                  padding: const EdgeInsets.all(12.0),
                  child: Row(
                    children: [
                      const Icon(Icons.error, color: Colors.red),
                      const SizedBox(width: 8),
                      Expanded(child: Text('Error: $_error', style: const TextStyle(color: Colors.red))),
                    ],
                  ),
                ),
              ),
            ],
            const SizedBox(height: 24),
            SizedBox(
              width: double.infinity,
              child: OutlinedButton.icon(
                onPressed: () => Navigator.push(context, MaterialPageRoute(builder: (_) => const HistoryPage())),
                icon: const Icon(Icons.history),
                label: const Text('Lihat Riwayat Absen'),
              ),
            ),
          ],
        ),
      ),
    );
  }
}
```

```dart
// lib/screens/history_page.dart
import 'package:flutter/material.dart';
import 'package:intl/intl.dart';
import '../services/auth_service.dart';
import '../services/db_helper.dart';
import '../models/attendance.dart';

class HistoryPage extends StatefulWidget {
  const HistoryPage({super.key});

  @override
  State<HistoryPage> createState() => _HistoryPageState();
}

class _HistoryPageState extends State<HistoryPage> {
  List<Attendance> _attendances = [];

  @override
  void initState() {
    super.initState();
    _loadHistory();
  }

  Future<void> _loadHistory() async {
    final userId = AuthService.currentUser!.id!;
    final dbHelper = DBHelper();
    final attendances = await dbHelper.getUserAttendances(userId);
    if (mounted) {
      setState(() => _attendances = attendances);
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Riwayat Absen'),
        backgroundColor: Colors.blue,
        foregroundColor: Colors.white,
      ),
      body: _attendances.isEmpty
          ? const Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Icon(Icons.history, size: 80, color: Colors.grey),
                  SizedBox(height: 16),
                  Text('Belum ada riwayat absen', style: TextStyle(fontSize: 18, color: Colors.grey)),
                ],
              ),
            )
          : ListView.builder(
              padding: const EdgeInsets.all(16),
              itemCount: _attendances.length,
              itemBuilder: (context, index) {
                final att = _attendances[index];
                final color = att.status == 'validated' ? Colors.green : att.status == 'rejected' ? Colors.red : Colors.orange;
                return Card(
                  margin: const EdgeInsets.only(bottom: 12),
                  child: ListTile(
                    leading: Icon(
                      att.type == 'check_in' ? Icons.login : Icons.logout,
                      color: color,
                    ),
                    title: Text('${att.date} - ${att.type.toUpperCase()}'),
                    subtitle: Column(
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: [
                        Text('${att.time} - Status: ${att.status.toUpperCase()}'),
                        if (att.userComment != null && att.userComment!.isNotEmpty)
                          Text('Keterangan: ${att.userComment}', style: const TextStyle(fontSize: 12)),
                        Text('Jarak: ${att.distanceM.toStringAsFixed(0)}m'),
                      ],
                    ),
                    trailing: Icon(Icons.arrow_forward_ios, size: 16),
                  ),
                );
              },
            ),
    );
  }
}
```

```dart
// lib/screens/admin/pending_list.dart
import 'package:flutter/material.dart';
import '../../services/db_helper.dart';
import '../../models/attendance.dart';
import 'validate_screen.dart';

class PendingListPage extends StatefulWidget {
  const PendingListPage({super.key});

  @override
  State<PendingListPage> createState() => _PendingListPageState();
}

class _PendingListPageState extends State<PendingListPage> {
  List<Attendance> _pendings = [];

  @override
  void initState() {
    super.initState();
    _loadPendings();
  }

  Future<void> _loadPendings() async {
    final dbHelper = DBHelper();
    final pendings = await dbHelper.getPendingAttendances();
    if (mounted) {
      setState(() => _pendings = pendings);
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: Text('Absensi Pending (${_pendings.length})'),
        backgroundColor: Colors.orange,
        foregroundColor: Colors.white,
      ),
      body: _pendings.isEmpty
          ? const Center(
              child: Column(
                mainAxisAlignment: MainAxisAlignment.center,
                children: [
                  Icon(Icons.pending_actions, size: 80, color: Colors.grey),
                  SizedBox(height: 16),
                  Text('Tidak ada absensi pending', style: TextStyle(fontSize: 18, color: Colors.grey)),
                ],
              ),
            )
          : ListView.builder(
              padding: const EdgeInsets.all(16),
              itemCount: _pendings.length,
              itemBuilder: (context, index) {
                final att = _pendings[index];
                return Card(
                  margin: const EdgeInsets.only(bottom: 12),
                  child: ListTile(
                    leading: CircleAvatar(
                      backgroundColor: Colors.orange,
                      child: Text(att.type.substring(0, 1).toUpperCase()),
                    ),
                    title: Text('${att.date} - ${att.type.toUpperCase()}'),
                    subtitle: Column(
                      crossAxisAlignment: CrossAxisAlignment.start,
                      children: [
                        Text('Jarak: ${att.distanceM.toStringAsFixed(0)}m'),
                        if (att.userComment != null && att.userComment!.isNotEmpty)
                          Text('Keterangan: ${att.userComment}'),
                      ],
                    ),
                    trailing: const Icon(Icons.arrow_forward_ios),
                    onTap: () => Navigator.push(
                      context,
                      MaterialPageRoute(
                        builder: (_) => ValidateScreen(attendance: att),
                      ),
                    ).then((_) => _loadPendings()),
                  ),
                );
              },
            ),
    );
  }
}
```

```dart
// lib/screens/admin/validate_screen.dart
import 'package:flutter/material.dart';
import 'package:google_maps_flutter/google_maps_flutter.dart';
import '../../services/auth_service.dart';
import '../../services/attendance_service.dart';
import '../../models/attendance.dart';

class ValidateScreen extends StatefulWidget {
  final Attendance attendance;
  const ValidateScreen({super.key, required this.attendance});

  @override
  State<ValidateScreen> createState() => _ValidateScreenState();
}

class _ValidateScreenState extends State<ValidateScreen> {
  final _commentController = TextEditingController();
  bool _isLoading = false;
  GoogleMapController? _mapController;

  @override
  void initState() {
    super.initState();
    _commentController.text = widget.attendance.adminComment ?? '';
  }

  Future<void> _validate(String status) async {
    setState(() => _isLoading = true);
    try {
      final adminId = AuthService.currentUser!.id!;
      await AttendanceService.validateAttendance(
        widget.attendance.id!,
        status,
        _commentController.text.isEmpty ? null : _commentController.text,
        adminId,
      );
      if (mounted) {
        Navigator.pop(context);
        ScaffoldMessenger.of(context).showSnackBar(SnackBar(content: Text('Status diubah ke $status'), backgroundColor: status == 'validated' ? Colors.green : Colors.red));
      }
    } catch (e) {
      if (mounted) ScaffoldMessenger.of(context).showSnackBar(SnackBar(content: Text('Error: $e'), backgroundColor: Colors.red));
    } finally {
      if (mounted) setState(() => _isLoading = false);
    }
  }

  @override
  Widget build(BuildContext context) {
    final center = LocationService.getCenterLocation(); // Async, but for simplicity
    return Scaffold(
      appBar: AppBar(
        title: Text('${widget.attendance.type.toUpperCase()} - Validasi'),
        backgroundColor: Colors.orange,
        foregroundColor: Colors.white,
      ),
      body: SingleChildScrollView(
        padding: const EdgeInsets.all(16.0),
        child: Column(
          crossAxisAlignment: CrossAxisAlignment.start,
          children: [
            Card(
              child: Padding(
                padding: const EdgeInsets.all(16),
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    const Icon(Icons.date_range, color: Colors.blue),
                    Text('Tanggal: ${widget.attendance.date}', style: const TextStyle(fontSize: 16)),
                    Text('Waktu: ${widget.attendance.time}', style: const TextStyle(fontSize: 16)),
                    Text('Jarak: ${widget.attendance.distanceM.toStringAsFixed(0)}m', style: const TextStyle(fontSize: 16)),
                    if (widget.attendance.userComment != null && widget.attendance.userComment!.isNotEmpty)
                      Text('Keterangan User: ${widget.attendance.userComment}', style: const TextStyle(fontSize: 16)),
                  ],
                ),
              ),
            ),
            const SizedBox(height: 16),
            Card(
              child: SizedBox(
                height: 200,
                child: GoogleMap(
                  initialCameraPosition: CameraPosition(
                    target: LatLng(widget.attendance.latitude, widget.attendance.longitude),
                    zoom: 15,
                  ),
                  markers: {
                    Marker(
                      markerId: const MarkerId('attendance'),
                      position: LatLng(widget.attendance.latitude, widget.attendance.longitude),
                      infoWindow: const InfoWindow(title: 'Lokasi Absen'),
                    ),
                    Marker(
                      markerId: const MarkerId('center'),
                      position: LatLng(-7.797068, 110.370529), // Default center
                      infoWindow: const InfoWindow(title: 'Lokasi Pusat'),
                    ),
                  },
                ),
              ),
            ),
            const SizedBox(height: 16),
            Card(
              child: Padding(
                padding: const EdgeInsets.all(16),
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    const Text('Komentar Admin:', style: TextStyle(fontWeight: FontWeight.bold)),
                    TextField(
                      controller: _commentController,
                      decoration: const InputDecoration(
                        hintText: 'Tambahkan komentar...',
                        border: OutlineInputBorder(),
                      ),
                      maxLines: 3,
                    ),
                  ],
                ),
              ),
            ),
            const SizedBox(height: 24),
            Row(
              children: [
                Expanded(
                  child: ElevatedButton.icon(
                    onPressed: _isLoading ? null : () => _validate('validated'),
                    icon: const Icon(Icons.check, color: Colors.white),
                    label: const Text('Approve'),
                    style: ElevatedButton.styleFrom(
                      backgroundColor: Colors.green,
                      padding: const EdgeInsets.symmetric(vertical: 12),
                    ),
                  ),
                ),
                const SizedBox(width: 16),
                Expanded(
                  child: ElevatedButton.icon(
                    onPressed: _isLoading ? null : () => _validate('rejected'),
                    icon: const Icon(Icons.close, color: Colors.white),
                    label: const Text('Reject'),
                    style: ElevatedButton.styleFrom(
                      backgroundColor: Colors.red,
                      padding: const EdgeInsets.symmetric(vertical: 12),
                    ),
                  ),
                ),
              ],
            ),
          ],
        ),
      ),
    );
  }
}
```

```dart
// lib/screens/super_admin/manage_users.dart
import 'package:flutter/material.dart';
import '../../models/user.dart';
import '../../services/db_helper.dart';
import '../../services/auth_service.dart';

class ManageUsersPage extends StatefulWidget {
  const ManageUsersPage({super.key});

  @override
  State<ManageUsersPage> createState() => _ManageUsersPageState();
}

class _ManageUsersPageState extends State<ManageUsersPage> {
  List<User> _users = [];

  @override
  void initState() {
    super.initState();
    _loadUsers();
  }

  Future<void> _loadUsers() async {
    final dbHelper = DBHelper();
    final users = await dbHelper.getAllUsers();
    if (mounted) setState(() => _users = users);
  }

  Future<void> _deleteUser(int id) async {
    final confirm = await showDialog<bool>(
      context: context,
      builder: (context) => AlertDialog(
        title: const Text('Hapus Pengguna?'),
        content: const Text('Aksi ini tidak bisa dibatalkan.'),
        actions: [
          TextButton(onPressed: () => Navigator.pop(context, false), child: const Text('Batal')),
          ElevatedButton(onPressed: () => Navigator.pop(context, true), child: const Text('Hapus')),
        ],
      ),
    );
    if (confirm == true) {
      final dbHelper = DBHelper();
      await dbHelper.deleteUser(id);
      _loadUsers();
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Kelola Pengguna'),
        backgroundColor: Colors.purple,
        foregroundColor: Colors.white,
      ),
      body: ListView.builder(
        padding: const EdgeInsets.all(16),
        itemCount: _users.length,
        itemBuilder: (context, index) {
          final user = _users[index];
          if (user.id == AuthService.currentUser?.id) return const SizedBox(); // Skip self
          return Card(
            margin: const EdgeInsets.only(bottom: 12),
            child: ListTile(
              leading: CircleAvatar(
                backgroundColor: user.role == 'super_admin' ? Colors.purple : user.role == 'admin' ? Colors.blue : Colors.green,
                child: Text(user.name[0].toUpperCase()),
              ),
              title: Text(user.name),
              subtitle: Column(
                crossAxisAlignment: CrossAxisAlignment.start,
                children: [
                  Text('Username: ${user.username}'),
                  Text('Role: ${user.role.toUpperCase()}'),
                  if (user.nip != null) Text('NIP: ${user.nip}'),
                ],
              ),
              trailing: IconButton(
                icon: const Icon(Icons.delete, color: Colors.red),
                onPressed: () => _deleteUser(user.id!),
              ),
            ),
          );
        },
      ),
      floatingActionButton: FloatingActionButton(
        onPressed: () {
          // TODO: Implement add user dialog/form
          ScaffoldMessenger.of(context).showSnackBar(const SnackBar(content: Text('Fitur tambah user belum diimplementasikan')));
        },
        backgroundColor: Colors.purple,
        child: const Icon(Icons.add),
      ),
    );
  }
}
```

```dart
// lib/screens/super_admin/settings_page.dart
import 'package:flutter/material.dart';
import '../../services/db_helper.dart';
import '../../services/export_service.dart';

class SettingsPage extends StatefulWidget {
  const SettingsPage({super.key});

  @override
  State<SettingsPage> createState() => _SettingsPageState();
}

class _SettingsPageState extends State<SettingsPage> {
  final _latController = TextEditingController();
  final _lngController = TextEditingController();
  final _distController = TextEditingController();

  @override
  void initState() {
    super.initState();
    _loadSettings();
  }

  Future<void> _loadSettings() async {
    final dbHelper = DBHelper();
    _latController.text = (await dbHelper.getSetting('center_lat')) ?? '';
    _lngController.text = (await dbHelper.getSetting('center_lng')) ?? '';
    _distController.text = (await dbHelper.getSetting('max_distance_m')) ?? '';
  }

  Future<void> _saveSettings() async {
    final dbHelper = DBHelper();
    await dbHelper.insertOrUpdateSetting('center_lat', _latController.text);
    await dbHelper.insertOrUpdateSetting('center_lng', _lngController.text);
    await dbHelper.insertOrUpdateSetting('max_distance_m', _distController.text);
    if (mounted) {
      ScaffoldMessenger.of(context).showSnackBar(const SnackBar(content: Text('Pengaturan disimpan'), backgroundColor: Colors.green));
    }
  }

  Future<void> _exportData() async {
    final path = await ExportService.exportAttendanceToCsv();
    if (mounted) {
      ScaffoldMessenger.of(context).showSnackBar(SnackBar(content: Text('Diexport ke: $path'), backgroundColor: Colors.green));
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text('Pengaturan'),
        backgroundColor: Colors.teal,
        foregroundColor: Colors.white,
      ),
      body: Padding(
        padding: const EdgeInsets.all(16.0),
        child: Column(
          children: [
            Card(
              child: Padding(
                padding: const EdgeInsets.all(16),
                child: Column(
                  crossAxisAlignment: CrossAxisAlignment.start,
                  children: [
                    const Text('Lokasi Pusat', style: TextStyle(fontWeight: FontWeight.bold, fontSize: 18)),
                    TextField(
                      controller: _latController,
                      decoration: const InputDecoration(labelText: 'Latitude', prefixIcon: Icon(Icons.location_on)),
                      keyboardType: TextInputType.numberWithOptions(decimal: true),
                    ),
                    TextField(
                      controller: _lngController,
                      decoration: const InputDecoration(labelText: 'Longitude', prefixIcon: Icon(Icons.location_on)),
                      keyboardType: TextInputType.numberWithOptions(decimal: true),
                    ),
                    TextField(
                      controller: _distController,
                      decoration: const InputDecoration(labelText: 'Radius Maks (meter)', prefixIcon: Icon(Icons.radius_active)),
                      keyboardType: TextInputType.number,
                    ),
                    const SizedBox(height: 16),
                    SizedBox(
                      width: double.infinity,
                      child: ElevatedButton.icon(
                        onPressed: _saveSettings,
                        icon: const Icon(Icons.save),
                        label: const Text('Simpan Pengaturan'),
                      ),
                    ),
                  ],
                ),
              ),
            ),
            const SizedBox(height: 24),
            Card(
              child: ListTile(
                leading: const Icon(Icons.download, color: Colors.blue),
                title: const Text('Export Rekap 30 Hari'),
                subtitle: const Text('Export ke CSV'),
                trailing: const Icon(Icons.arrow_forward_ios),
                onTap: _exportData,
              ),
            ),
          ],
        ),
      ),
    );
  }
}
```

# README.md

## Absensi Guru - Flutter App

Aplikasi absensi guru menggunakan Flutter dengan selfie, GPS, dan map.

### Dependencies
Pastikan pubspec.yaml sesuai. Jalankan `flutter pub get`.

### Setup Map (Google Maps)
- Dapatkan API key dari Google Cloud Console.
- Tambahkan ke `android/app/src/main/AndroidManifest.xml`: `<meta-data android:name="com.google.android.geo.API_KEY" android:value="YOUR_API_KEY"/>`
- Untuk iOS, tambahkan ke `ios/Runner/AppDelegate.swift`.

### Cara Run di Android
1. `flutter run` di emulator/device Android.
2. Permissions akan diminta saat pertama kali.

### Cara Run di Windows
1. Enable Flutter desktop: `flutter config --enable-windows-desktop`.
2. `flutter run -d windows`.
3. sqflite_common_ffi handles SQLite on Windows.

### Login Credentials (Seed Data)
- Super Admin: username `super`, password `admin123`
- Admin: `admin` / `admin123`
- Guru 1 (PNS): `guru1` / `guru123`
- Guru 2 (non-PNS): `guru2` / `guru123`

### Notes
- Password plaintext untuk POC; implement bcrypt untuk production.
- Foto disimpan di app documents directory.
- Export CSV ke external storage atau app dir.
- Map menggunakan google_maps_flutter; pastikan API key.
- UI diperbaiki dengan Card, ikon, gradient, dan warna menarik.
- Saat absen, dialog map muncul untuk konfirmasi lokasi user vs pusat.