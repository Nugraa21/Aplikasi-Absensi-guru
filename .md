grog kamu bisa bantu aku buat edit dashboard admin jadi gini dashboardnya ediot agar menarik jadi di setiap profile user admin bisa klick dan lihat data absensi setiap user jadi biar g kayak beruntun banyak gitu biar tau siapa saja yang absensi gitu grog sama ini juga dashboard adminya kamu bisa edit agar menarik g dan sesuwai kan admin tau lah
 
 
 

```dart
import 'dart:io';
import 'dart:ui';
import 'package:flutter/material.dart';
import '../services/db_service.dart';

class AdminDashboard extends StatefulWidget {
  const AdminDashboard({super.key});

  @override
  State<AdminDashboard> createState() => _AdminDashboardState();
}

class _AdminDashboardState extends State<AdminDashboard> {
  int _currentIndex = 0;

  List<Map<String, dynamic>> pendingUsers = [];
  List<Map<String, dynamic>> allUsers = [];
  List<Map<String, dynamic>> allAttendance = [];
  final radiusCtrl = TextEditingController();
  bool loading = true;

  @override
  void initState() {
    super.initState();
    _loadAll();
  }

  Future<void> _loadAll() async {
    setState(() => loading = true);
    pendingUsers = await DBService.getPendingUsers();
    allUsers = await DBService.getAllUsers();
    allAttendance = await DBService.getAllAttendance();
    final r = await DBService.getSetting('attendance_radius');
    radiusCtrl.text = r.isNotEmpty ? r : '1000';
    setState(() => loading = false);
  }

  Widget _glass({required Widget child}) => ClipRRect(
    borderRadius: BorderRadius.circular(12),
    child: BackdropFilter(
      filter: ImageFilter.blur(sigmaX: 8, sigmaY: 8),
      child: Container(
        padding: const EdgeInsets.all(12),
        decoration: BoxDecoration(
          color: Colors.white.withOpacity(0.08),
          borderRadius: BorderRadius.circular(12),
          border: Border.all(color: Colors.white.withOpacity(0.06)),
        ),
        child: child,
      ),
    ),
  );

  Future<void> _approveUser(int id) async {
    await DBService.approveUser(id);
    await _loadAll();
    ScaffoldMessenger.of(
      context,
    ).showSnackBar(const SnackBar(content: Text("Akun disetujui")));
  }

  Future<void> _denyUser(int id) async {
    await DBService.denyUser(id);
    await _loadAll();
    ScaffoldMessenger.of(
      context,
    ).showSnackBar(const SnackBar(content: Text("Akun ditolak & dihapus")));
  }

  Future<void> _approveAttendance(int id) async {
    await DBService.approveAttendance(id);
    await _loadAll();
    ScaffoldMessenger.of(
      context,
    ).showSnackBar(const SnackBar(content: Text("Absensi disetujui")));
  }

  Future<void> _denyAttendance(int id) async {
    await DBService.denyAttendance(id);
    await _loadAll();
    ScaffoldMessenger.of(
      context,
    ).showSnackBar(const SnackBar(content: Text("Absensi dihapus")));
  }

  Future<void> _saveRadius() async {
    final val = radiusCtrl.text.trim();
    if (double.tryParse(val) == null) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(content: Text("Masukkan angka radius valid (meter)")),
      );
      return;
    }
    await DBService.setSetting('attendance_radius', val);
    await _loadAll();
    ScaffoldMessenger.of(
      context,
    ).showSnackBar(const SnackBar(content: Text("Radius disimpan")));
  }

  Widget _pendingUsersTab() => _glass(
    child: Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        const Text(
          "Konfirmasi User Baru",
          style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
        ),
        const SizedBox(height: 8),
        if (pendingUsers.isEmpty) const Text("Tidak ada pendaftaran baru."),
        ListView.separated(
          shrinkWrap: true,
          physics: const NeverScrollableScrollPhysics(),
          itemCount: pendingUsers.length,
          separatorBuilder: (_, __) => const Divider(),
          itemBuilder: (ctx, i) {
            final u = pendingUsers[i];
            return ListTile(
              leading: CircleAvatar(
                child: Text(u['name']?.substring(0, 1) ?? '?'),
              ),
              title: Text(u['name'] ?? '-'),
              subtitle: Text(
                "${u['jabatan'] ?? '-'} • ${u['kelas'] ?? '-'}\n${u['email']}",
              ),
              isThreeLine: true,
              trailing: Row(
                mainAxisSize: MainAxisSize.min,
                children: [
                  IconButton(
                    icon: const Icon(Icons.check, color: Colors.green),
                    onPressed: () => _approveUser(u['id']),
                  ),
                  IconButton(
                    icon: const Icon(Icons.close, color: Colors.red),
                    onPressed: () => _denyUser(u['id']),
                  ),
                ],
              ),
            );
          },
        ),
      ],
    ),
  );

  Widget _allUsersTab() => _glass(
    child: Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        const Text(
          "Semua User",
          style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
        ),
        const SizedBox(height: 8),
        ListView.separated(
          shrinkWrap: true,
          physics: const NeverScrollableScrollPhysics(),
          itemCount: allUsers.length,
          separatorBuilder: (_, __) => const Divider(),
          itemBuilder: (ctx, i) {
            final u = allUsers[i];
            return ListTile(
              leading: CircleAvatar(
                backgroundImage: (u['photo'] ?? '').isNotEmpty
                    ? FileImage(File(u['photo']))
                    : null,
                child: (u['photo'] ?? '').isEmpty
                    ? const Icon(Icons.person)
                    : null,
              ),
              title: Text(u['name'] ?? '-'),
              subtitle: Text("${u['jabatan']} • ${u['kelas']}\n${u['email']}"),
              isThreeLine: true,
            );
          },
        ),
      ],
    ),
  );

  Widget _attendanceTab() => _glass(
    child: Column(
      crossAxisAlignment: CrossAxisAlignment.start,
      children: [
        const Text(
          "Konfirmasi Absensi",
          style: TextStyle(fontSize: 18, fontWeight: FontWeight.bold),
        ),
        const SizedBox(height: 8),
        ListView.builder(
          shrinkWrap: true,
          physics: const NeverScrollableScrollPhysics(),
          itemCount: allAttendance.length,
          itemBuilder: (ctx, i) {
            final a = allAttendance[i];
            return Card(
              child: ListTile(
                leading: a['photo'] != null
                    ? Image.file(
                        File(a['photo']),
                        width: 64,
                        height: 64,
                        fit: BoxFit.cover,
                      )
                    : null,
                title: Text("${a['date']} ${a['time']}"),
                subtitle: FutureBuilder<Map<String, dynamic>?>(
                  future: DBService.getUserById(a['userId']),
                  builder: (context, snap) {
                    final u = snap.data;
                    return Text(
                      "Guru: ${u != null ? u['name'] : '-'}\nLokasi: ${a['location']}\nStatus: ${(a['approved'] ?? 0) == 1 ? 'Approved' : 'Pending'}",
                    );
                  },
                ),
                isThreeLine: true,
                trailing: Column(
                  mainAxisAlignment: MainAxisAlignment.center,
                  children: [
                    if ((a['approved'] ?? 0) == 0)
                      IconButton(
                        icon: const Icon(Icons.check, color: Colors.green),
                        onPressed: () => _approveAttendance(a['id']),
                      ),
                    IconButton(
                      icon: const Icon(Icons.delete, color: Colors.red),
                      onPressed: () => _denyAttendance(a['id']),
                    ),
                  ],
                ),
              ),
            );
          },
        ),
      ],
    ),
  );

  Widget _radiusTab() => _glass(
    child: Row(
      children: [
        Expanded(
          child: TextField(
            controller: radiusCtrl,
            keyboardType: TextInputType.number,
            decoration: const InputDecoration(
              labelText: 'Radius absensi (meter)',
            ),
          ),
        ),
        const SizedBox(width: 8),
        ElevatedButton(
          onPressed: _saveRadius,
          style: ElevatedButton.styleFrom(backgroundColor: Colors.orange),
          child: const Text("Simpan"),
        ),
      ],
    ),
  );

  @override
  Widget build(BuildContext context) {
    final tabs = [
      _pendingUsersTab(),
      _allUsersTab(),
      _attendanceTab(),
      _radiusTab(),
    ];
    return Scaffold(
      appBar: AppBar(
        title: const Text("Dashboard Admin"),
        backgroundColor: Colors.deepOrange,
      ),
      body: loading
          ? const Center(child: CircularProgressIndicator())
          : RefreshIndicator(
              onRefresh: _loadAll,
              child: SingleChildScrollView(
                padding: const EdgeInsets.all(16),
                physics: const AlwaysScrollableScrollPhysics(),
                child: tabs[_currentIndex],
              ),
            ),
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: _currentIndex,
        selectedItemColor: Colors.deepOrange,
        unselectedItemColor: Colors.grey,
        onTap: (i) => setState(() => _currentIndex = i),
        items: const [
          BottomNavigationBarItem(
            icon: Icon(Icons.person_add),
            label: "User Baru",
          ),
          BottomNavigationBarItem(icon: Icon(Icons.group), label: "User"),
          BottomNavigationBarItem(
            icon: Icon(Icons.assignment),
            label: "Absensi",
          ),
          BottomNavigationBarItem(icon: Icon(Icons.settings), label: "Radius"),
        ],
      ),
    );
  }
}
```

 
 
ini aku kirim code yang lainya juga
 

```dart
import 'dart:io';
import 'package:flutter/material.dart';
import 'package:camera/camera.dart';
import 'package:intl/intl.dart';
import 'package:path_provider/path_provider.dart';
import '../services/location_service.dart';
import '../services/db_service.dart';

class AttendancePage extends StatefulWidget {
  final Map<String, dynamic> user;
  const AttendancePage({super.key, required this.user});

  @override
  State<AttendancePage> createState() => _AttendancePageState();
}

class _AttendancePageState extends State<AttendancePage> {
  CameraController? _controller;
  bool loading = false;
  double radiusMeters = 1000;
  // center approx SMK N 2 Yogyakarta
  final double centerLat = -7.797068;
  final double centerLng = 110.370529;

  @override
  void initState() {
    super.initState();
    _initCamera();
    _loadRadius();
  }

  Future<void> _loadRadius() async {
    final v = await DBService.getSetting('attendance_radius');
    setState(() => radiusMeters = double.tryParse(v) ?? 1000);
  }

  Future<void> _initCamera() async {
    final cams = await availableCameras();
    final front = cams.firstWhere(
      (c) => c.lensDirection == CameraLensDirection.front,
      orElse: () => cams.first,
    );
    _controller = CameraController(front, ResolutionPreset.medium);
    await _controller!.initialize();
    if (mounted) setState(() {});
  }

  Future<void> _takeAndSave() async {
    if (_controller == null || !_controller!.value.isInitialized) return;
    setState(() => loading = true);

    final pos = await LocationService.getCurrentPosition();
    if (pos == null) {
      setState(() => loading = false);
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(
          content: Text("Gagal dapat lokasi / izin belum diberikan"),
        ),
      );
      return;
    }

    final dist = LocationService.distanceInMeters(
      pos.latitude,
      pos.longitude,
      centerLat,
      centerLng,
    );
    if (dist > radiusMeters) {
      setState(() => loading = false);
      ScaffoldMessenger.of(context).showSnackBar(
        SnackBar(
          content: Text(
            "Di luar area absensi (${(dist / 1000).toStringAsFixed(2)} km)",
          ),
        ),
      );
      return;
    }

    final xfile = await _controller!.takePicture();
    final dir = await getApplicationDocumentsDirectory();
    final savePath =
        '${dir.path}/absen_${widget.user['id']}_${DateTime.now().millisecondsSinceEpoch}.jpg';
    await File(xfile.path).copy(savePath);

    final date = DateFormat('yyyy-MM-dd').format(DateTime.now());
    final time = DateFormat('HH:mm:ss').format(DateTime.now());
    await DBService.saveAttendance(
      widget.user['id'],
      date,
      time,
      '${pos.latitude},${pos.longitude}',
      savePath,
    );

    setState(() => loading = false);
    ScaffoldMessenger.of(context).showSnackBar(
      const SnackBar(
        content: Text(
          "Absensi tersimpan (pending). Menunggu konfirmasi admin.",
        ),
      ),
    );
  }

  @override
  Widget build(BuildContext context) {
    if (_controller == null || !_controller!.value.isInitialized) {
      return const Center(child: CircularProgressIndicator());
    }
    return Column(
      children: [
        Expanded(child: CameraPreview(_controller!)),
        Padding(
          padding: const EdgeInsets.all(16),
          child: Column(
            children: [
              Text(
                "Radius absensi: ${radiusMeters.toInt()} m",
                style: const TextStyle(color: Colors.black54),
              ),
              const SizedBox(height: 8),
              ElevatedButton.icon(
                onPressed: loading ? null : _takeAndSave,
                style: ElevatedButton.styleFrom(
                  backgroundColor: Colors.deepOrange,
                  minimumSize: const Size.fromHeight(48),
                ),
                icon: const Icon(Icons.camera_alt),
                label: loading
                    ? const CircularProgressIndicator(color: Colors.white)
                    : const Text("Kirim Selfie & Absen"),
              ),
            ],
          ),
        ),
      ],
    );
  }

  @override
  void dispose() {
    _controller?.dispose();
    super.dispose();
  }
}
```

 

```dart
import 'dart:io';
import 'package:flutter/material.dart';
import '../services/db_service.dart';

class HistoryPage extends StatefulWidget {
  final Map<String, dynamic> user;
  const HistoryPage({super.key, required this.user});

  @override
  State<HistoryPage> createState() => _HistoryPageState();
}

class _HistoryPageState extends State<HistoryPage> {
  late Future<List<Map<String, dynamic>>> _future;

  @override
  void initState() {
    super.initState();
    _future = DBService.getAttendance(widget.user['id']);
  }

  Future<void> _refresh() async {
    setState(() {
      _future = DBService.getAttendance(widget.user['id']);
    });
  }

  @override
  Widget build(BuildContext context) {
    return FutureBuilder<List<Map<String, dynamic>>>(
      future: _future,
      builder: (context, snap) {
        if (snap.connectionState != ConnectionState.done)
          return const Center(child: CircularProgressIndicator());
        final list = snap.data ?? [];
        if (list.isEmpty)
          return Center(
            child: Text(
              "Belum ada absensi.",
              style: TextStyle(color: Colors.grey.shade700),
            ),
          );
        return RefreshIndicator(
          onRefresh: _refresh,
          child: ListView.builder(
            padding: const EdgeInsets.all(12),
            itemCount: list.length,
            itemBuilder: (ctx, i) {
              final a = list[i];
              final approved = (a['approved'] ?? 0) == 1;
              return Card(
                margin: const EdgeInsets.symmetric(vertical: 8),
                child: ListTile(
                  leading: a['photo'] != null
                      ? Image.file(
                          File(a['photo']),
                          width: 64,
                          height: 64,
                          fit: BoxFit.cover,
                        )
                      : null,
                  title: Text("${a['date']} ${a['time']}"),
                  subtitle: Text(
                    "Lokasi: ${a['location']}\nStatus: ${approved ? 'Approved' : 'Pending'}",
                  ),
                  isThreeLine: true,
                ),
              );
            },
          ),
        );
      },
    );
  }
}
```

 

```dart
import 'package:flutter/material.dart';
import 'attendance_page.dart';
import 'history_page.dart';
import 'profile_page.dart';
import 'admin_dashboard.dart';
import 'login_page.dart';

class HomePage extends StatefulWidget {
  final Map<String, dynamic> user;
  const HomePage({super.key, required this.user});

  @override
  State<HomePage> createState() => _HomePageState();
}

class _HomePageState extends State<HomePage> {
  int currentIndex = 0;
  late final List<Widget> pages;

  @override
  void initState() {
    super.initState();
    pages = [
      AttendancePage(user: widget.user),
      HistoryPage(user: widget.user),
      ProfilePage(user: widget.user),
    ];
  }

  void _logout() {
    Navigator.pushAndRemoveUntil(
      context,
      MaterialPageRoute(builder: (_) => const LoginPage()),
      (r) => false,
    );
  }

  @override
  Widget build(BuildContext context) {
    final isAdmin = (widget.user['isAdmin'] ?? 0) == 1;
    return Scaffold(
      appBar: AppBar(
        title: Text("Halo, ${widget.user['name'] ?? 'User'}"),
        backgroundColor: Colors.deepOrange,
        actions: [
          IconButton(
            icon: const Icon(Icons.logout),
            onPressed: _logout,
            tooltip: 'Logout',
          ),
          if (isAdmin)
            IconButton(
              icon: const Icon(Icons.admin_panel_settings),
              onPressed: () => Navigator.push(
                context,
                MaterialPageRoute(builder: (_) => const AdminDashboard()),
              ),
              tooltip: 'Admin Dashboard',
            ),
        ],
      ),
      body: AnimatedSwitcher(
        duration: const Duration(milliseconds: 250),
        child: pages[currentIndex],
      ),
      bottomNavigationBar: BottomNavigationBar(
        currentIndex: currentIndex,
        selectedItemColor: Colors.deepOrange,
        onTap: (i) => setState(() => currentIndex = i),
        items: const [
          BottomNavigationBarItem(
            icon: Icon(Icons.camera_alt),
            label: 'Absensi',
          ),
          BottomNavigationBarItem(icon: Icon(Icons.history), label: 'Riwayat'),
          BottomNavigationBarItem(icon: Icon(Icons.person), label: 'Profil'),
        ],
      ),
    );
  }
}
```

 

```dart
import 'package:flutter/material.dart';
import '../services/db_service.dart';
import 'home_page.dart';
import 'register_page.dart';
import '../widgets/custom_button.dart';

class LoginPage extends StatefulWidget {
  const LoginPage({super.key});
  @override
  State<LoginPage> createState() => _LoginPageState();
}

class _LoginPageState extends State<LoginPage> {
  final emailCtrl = TextEditingController();
  final passCtrl = TextEditingController();
  bool loading = false;

  Future<void> _login() async {
    setState(() => loading = true);
    final user = await DBService.login(
      emailCtrl.text.trim(),
      passCtrl.text.trim(),
    );
    setState(() => loading = false);
    if (user == null) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(content: Text("Login gagal: email/password salah")),
      );
      return;
    }
    if ((user['isAdmin'] ?? 0) == 0 && (user['isApproved'] ?? 0) == 0) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(
          content: Text("Akun belum disetujui admin. Tunggu konfirmasi."),
        ),
      );
      return;
    }
    Navigator.pushReplacement(
      context,
      MaterialPageRoute(builder: (_) => HomePage(user: user)),
    );
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      body: Center(
        child: Container(
          constraints: const BoxConstraints(maxWidth: 520),
          padding: const EdgeInsets.all(20),
          child: Column(
            mainAxisAlignment: MainAxisAlignment.center,
            children: [
              const Text(
                "Absensi Guru",
                style: TextStyle(fontSize: 32, fontWeight: FontWeight.bold),
              ),
              const SizedBox(height: 8),
              const Text(
                "Login (Guru/Admin)",
                style: TextStyle(color: Colors.black54),
              ),
              const SizedBox(height: 20),
              TextField(
                controller: emailCtrl,
                decoration: const InputDecoration(labelText: "Email"),
              ),
              const SizedBox(height: 12),
              TextField(
                controller: passCtrl,
                obscureText: true,
                decoration: const InputDecoration(labelText: "Password"),
              ),
              const SizedBox(height: 18),
              CustomButton(
                text: loading ? "Memproses..." : "Login",
                onPressed: loading ? () {} : _login,
              ),
              const SizedBox(height: 12),
              TextButton(
                onPressed: () => Navigator.push(
                  context,
                  MaterialPageRoute(builder: (_) => const RegisterPage()),
                ),
                child: const Text("Belum punya akun? Daftar"),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
```

 

```dart
import 'dart:io';
import 'dart:ui';
import 'package:flutter/material.dart';
import 'package:image_picker/image_picker.dart';
import '../services/db_service.dart';

class ProfilePage extends StatefulWidget {
  final Map<String, dynamic> user;
  const ProfilePage({super.key, required this.user});

  @override
  State<ProfilePage> createState() => _ProfilePageState();
}

class _ProfilePageState extends State<ProfilePage> {
  late TextEditingController nameCtrl;
  late TextEditingController nipCtrl;
  late TextEditingController jabatanCtrl;
  late TextEditingController kelasCtrl;
  String photoPath = '';
  bool loading = false;

  @override
  void initState() {
    super.initState();
    nameCtrl = TextEditingController(text: widget.user['name']);
    nipCtrl = TextEditingController(text: widget.user['nip']);
    jabatanCtrl = TextEditingController(text: widget.user['jabatan']);
    kelasCtrl = TextEditingController(text: widget.user['kelas']);
    photoPath = widget.user['photo'] ?? '';
  }

  Widget _glass({required Widget child}) {
    return ClipRRect(
      borderRadius: BorderRadius.circular(14),
      child: BackdropFilter(
        filter: ImageFilter.blur(sigmaX: 8, sigmaY: 8),
        child: Container(
          padding: const EdgeInsets.all(16),
          decoration: BoxDecoration(
            color: Colors.white.withOpacity(0.08),
            borderRadius: BorderRadius.circular(14),
            border: Border.all(color: Colors.white.withOpacity(0.06)),
          ),
          child: child,
        ),
      ),
    );
  }

  Future<void> pickImage() async {
    final p = ImagePicker();
    final img = await p.pickImage(
      source: ImageSource.gallery,
      imageQuality: 80,
    );
    if (img != null) setState(() => photoPath = img.path);
  }

  Future<void> save() async {
    setState(() => loading = true);
    await DBService.updateProfile(
      widget.user['id'],
      nameCtrl.text.trim(),
      nipCtrl.text.trim(),
      jabatanCtrl.text.trim(),
      kelasCtrl.text.trim(),
      photoPath,
    );
    setState(() => loading = false);
    ScaffoldMessenger.of(
      context,
    ).showSnackBar(const SnackBar(content: Text("Profil disimpan")));
  }

  Future<void> logout() async {
    Navigator.pushAndRemoveUntil(
      context,
      MaterialPageRoute(builder: (_) => const SizedBox.shrink()),
      (r) => false,
    );
  }

  @override
  Widget build(BuildContext context) {
    return Center(
      child: Container(
        constraints: const BoxConstraints(maxWidth: 640),
        padding: const EdgeInsets.all(20),
        child: _glass(
          child: Column(
            mainAxisSize: MainAxisSize.min,
            children: [
              GestureDetector(
                onTap: pickImage,
                child: CircleAvatar(
                  radius: 56,
                  backgroundImage: photoPath.isNotEmpty
                      ? FileImage(File(photoPath))
                      : null,
                  child: photoPath.isEmpty
                      ? const Icon(Icons.person, size: 56)
                      : null,
                ),
              ),
              const SizedBox(height: 12),
              TextField(
                controller: nameCtrl,
                decoration: const InputDecoration(labelText: "Nama"),
              ),
              const SizedBox(height: 8),
              TextField(
                controller: nipCtrl,
                decoration: const InputDecoration(labelText: "NIP"),
              ),
              const SizedBox(height: 8),
              TextField(
                controller: jabatanCtrl,
                decoration: const InputDecoration(labelText: "Jabatan"),
              ),
              const SizedBox(height: 8),
              TextField(
                controller: kelasCtrl,
                decoration: const InputDecoration(
                  labelText: "Kelas (mengajar)",
                ),
              ),
              const SizedBox(height: 12),
              ElevatedButton(
                onPressed: loading ? null : save,
                style: ElevatedButton.styleFrom(
                  backgroundColor: Colors.deepOrange,
                ),
                child: loading
                    ? const CircularProgressIndicator(color: Colors.white)
                    : const Text("Simpan Profil"),
              ),
              const SizedBox(height: 8),
              OutlinedButton(
                onPressed: () {
                  Navigator.pushAndRemoveUntil(
                    context,
                    MaterialPageRoute(builder: (_) => const SizedBox.shrink()),
                    (r) => false,
                  );
                },
                style: OutlinedButton.styleFrom(
                  foregroundColor: Colors.deepOrange,
                ),
                child: const Text("Logout (kembali ke login)"),
              ),
            ],
          ),
        ),
      ),
    );
  }
}
```

 

```dart
import 'package:flutter/material.dart';
import '../services/db_service.dart';
import '../widgets/custom_button.dart';

class RegisterPage extends StatefulWidget {
  const RegisterPage({super.key});
  @override
  State<RegisterPage> createState() => _RegisterPageState();
}

class _RegisterPageState extends State<RegisterPage> {
  final nameCtrl = TextEditingController();
  final nipCtrl = TextEditingController();
  final jabatanCtrl = TextEditingController();
  final kelasCtrl = TextEditingController();
  final emailCtrl = TextEditingController();
  final passCtrl = TextEditingController();
  bool asAdmin = false;
  bool loading = false;

  Future<void> _register() async {
    if (nameCtrl.text.isEmpty ||
        emailCtrl.text.isEmpty ||
        passCtrl.text.isEmpty) {
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(content: Text("Isi Nama, Email, Password.")),
      );
      return;
    }
    setState(() => loading = true);
    try {
      await DBService.registerUser(
        name: nameCtrl.text.trim(),
        nip: nipCtrl.text.trim(),
        jabatan: jabatanCtrl.text.trim(),
        kelas: kelasCtrl.text.trim(),
        email: emailCtrl.text.trim(),
        password: passCtrl.text.trim(),
        isAdmin: asAdmin ? 1 : 0,
        isApproved: asAdmin
            ? 1
            : 0, // admin creation auto approved; normal guru pending
      );
      ScaffoldMessenger.of(context).showSnackBar(
        const SnackBar(
          content: Text(
            "Registrasi berhasil. Tunggu konfirmasi admin (untuk guru).",
          ),
        ),
      );
      Navigator.pop(context);
    } catch (e) {
      ScaffoldMessenger.of(
        context,
      ).showSnackBar(SnackBar(content: Text("Gagal registrasi: $e")));
    } finally {
      setState(() => loading = false);
    }
  }

  @override
  Widget build(BuildContext context) {
    return Scaffold(
      appBar: AppBar(
        title: const Text("Daftar Akun"),
        backgroundColor: Colors.deepOrange,
      ),
      body: Center(
        child: Container(
          constraints: const BoxConstraints(maxWidth: 700),
          padding: const EdgeInsets.all(20),
          child: ListView(
            shrinkWrap: true,
            children: [
              TextField(
                controller: nameCtrl,
                decoration: const InputDecoration(labelText: "Nama Lengkap"),
              ),
              const SizedBox(height: 8),
              TextField(
                controller: nipCtrl,
                decoration: const InputDecoration(labelText: "NIP"),
              ),
              const SizedBox(height: 8),
              TextField(
                controller: jabatanCtrl,
                decoration: const InputDecoration(labelText: "Jabatan"),
              ),
              const SizedBox(height: 8),
              TextField(
                controller: kelasCtrl,
                decoration: const InputDecoration(
                  labelText: "Kelas (mengajar)",
                ),
              ),
              const SizedBox(height: 8),
              TextField(
                controller: emailCtrl,
                decoration: const InputDecoration(labelText: "Email"),
              ),
              const SizedBox(height: 8),
              TextField(
                controller: passCtrl,
                obscureText: true,
                decoration: const InputDecoration(labelText: "Password"),
              ),
              const SizedBox(height: 12),
              Row(
                children: [
                  const Text("Buat akun sebagai Admin?"),
                  Checkbox(
                    value: asAdmin,
                    onChanged: (v) => setState(() => asAdmin = v ?? false),
                  ),
                ],
              ),
              const SizedBox(height: 8),
              CustomButton(
                text: loading ? "Memproses..." : "Daftar",
                onPressed: loading ? () {} : _register,
              ),
            ],
          ),
        ),
      ),
    );
  }
}
```

 

```dart
import 'package:sqflite/sqflite.dart';
import 'package:path/path.dart';

class DBService {
  // --- Get user by ID ---
  static Future<Map<String, dynamic>?> getUserById(int id) async {
    final db = await getDB();
    final res = await db.query('users', where: 'id = ?', whereArgs: [id]);
    return res.isNotEmpty ? res.first : null;
  }

  static Database? _db;

  static Future<Database> getDB() async {
    if (_db != null) return _db!;
    final path = join(await getDatabasesPath(), 'absensi.db');
    _db = await openDatabase(
      path,
      version: 2,
      onCreate: (db, v) async {
        await db.execute('''
        CREATE TABLE users(
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          name TEXT,
          nip TEXT,
          jabatan TEXT,
          kelas TEXT,
          email TEXT UNIQUE,
          password TEXT,
          photo TEXT,
          isAdmin INTEGER DEFAULT 0,
          isApproved INTEGER DEFAULT 0
        )
      ''');
        await db.execute('''
        CREATE TABLE attendance(
          id INTEGER PRIMARY KEY AUTOINCREMENT,
          userId INTEGER,
          date TEXT,
          time TEXT,
          location TEXT,
          photo TEXT,
          approved INTEGER DEFAULT 0
        )
      ''');
        await db.execute('''
        CREATE TABLE settings(
          id INTEGER PRIMARY KEY,
          keyName TEXT UNIQUE,
          value TEXT
        )
      ''');
        // default radius setting (meters)
        await db.insert('settings', {
          'id': 1,
          'keyName': 'attendance_radius',
          'value': '1000',
        });
      },
      onUpgrade: (db, oldV, newV) async {
        if (oldV < 2) {
          try {
            await db.execute(
              'ALTER TABLE users ADD COLUMN isApproved INTEGER DEFAULT 0',
            );
          } catch (_) {}
        }
      },
    );
    return _db!;
  }

  // --- Users ---
  static Future<int> registerUser({
    required String name,
    required String nip,
    required String jabatan,
    required String kelas,
    required String email,
    required String password,
    int isAdmin = 0,
    int isApproved = 0,
  }) async {
    final db = await getDB();
    return await db.insert('users', {
      'name': name,
      'nip': nip,
      'jabatan': jabatan,
      'kelas': kelas,
      'email': email,
      'password': password,
      'photo': '',
      'isAdmin': isAdmin,
      'isApproved': isApproved,
    });
  }

  static Future<Map<String, dynamic>?> login(
    String email,
    String password,
  ) async {
    final db = await getDB();
    final res = await db.query(
      'users',
      where: 'email=? AND password=?',
      whereArgs: [email, password],
    );
    return res.isNotEmpty ? res.first : null;
  }

  static Future<List<Map<String, dynamic>>> getAllUsers() async {
    final db = await getDB();
    return await db.query('users', orderBy: 'isAdmin DESC, name ASC');
  }

  static Future<List<Map<String, dynamic>>> getPendingUsers() async {
    final db = await getDB();
    return await db.query('users', where: 'isApproved=0', orderBy: 'name ASC');
  }

  static Future<int> approveUser(int id) async {
    final db = await getDB();
    return await db.update(
      'users',
      {'isApproved': 1},
      where: 'id=?',
      whereArgs: [id],
    );
  }

  static Future<int> denyUser(int id) async {
    final db = await getDB();
    await db.delete('attendance', where: 'userId=?', whereArgs: [id]);
    return await db.delete('users', where: 'id=?', whereArgs: [id]);
  }

  static Future<int> updateProfile(
    int userId,
    String name,
    String nip,
    String jabatan,
    String kelas,
    String photo,
  ) async {
    final db = await getDB();
    return await db.update(
      'users',
      {
        'name': name,
        'nip': nip,
        'jabatan': jabatan,
        'kelas': kelas,
        'photo': photo,
      },
      where: 'id=?',
      whereArgs: [userId],
    );
  }

  // --- Attendance ---
  static Future<int> saveAttendance(
    int userId,
    String date,
    String time,
    String location,
    String photoPath,
  ) async {
    final db = await getDB();
    return await db.insert('attendance', {
      'userId': userId,
      'date': date,
      'time': time,
      'location': location,
      'photo': photoPath,
      'approved': 0,
    });
  }

  static Future<List<Map<String, dynamic>>> getAttendance(int userId) async {
    final db = await getDB();
    return await db.query(
      'attendance',
      where: 'userId=?',
      whereArgs: [userId],
      orderBy: 'date DESC, time DESC',
    );
  }

  static Future<List<Map<String, dynamic>>> getAllAttendance() async {
    final db = await getDB();
    return await db.query('attendance', orderBy: 'date DESC, time DESC');
  }

  static Future<int> approveAttendance(int id) async {
    final db = await getDB();
    return await db.update(
      'attendance',
      {'approved': 1},
      where: 'id=?',
      whereArgs: [id],
    );
  }

  static Future<int> denyAttendance(int id) async {
    final db = await getDB();
    return await db.delete('attendance', where: 'id=?', whereArgs: [id]);
  }

  // --- Settings ---
  static Future<String> getSetting(String key) async {
    final db = await getDB();
    final res = await db.query(
      'settings',
      where: 'keyName=?',
      whereArgs: [key],
    );
    return res.isNotEmpty ? res.first['value'] as String : '';
  }

  static Future<int> setSetting(String key, String value) async {
    final db = await getDB();
    final exists = await db.query(
      'settings',
      where: 'keyName=?',
      whereArgs: [key],
    );
    if (exists.isNotEmpty) {
      return await db.update(
        'settings',
        {'value': value},
        where: 'keyName=?',
        whereArgs: [key],
      );
    } else {
      return await db.insert('settings', {'keyName': key, 'value': value});
    }
  }
}
```

 

```dart
import 'package:geolocator/geolocator.dart';
import 'dart:math';

class LocationService {
  static Future<bool> checkPermission() async {
    LocationPermission permission = await Geolocator.checkPermission();
    if (permission == LocationPermission.denied) {
      permission = await Geolocator.requestPermission();
    }
    return permission == LocationPermission.always ||
        permission == LocationPermission.whileInUse;
  }

  static Future<Position?> getCurrentPosition() async {
    if (await checkPermission()) {
      return await Geolocator.getCurrentPosition(
        desiredAccuracy: LocationAccuracy.high,
      );
    }
    return null;
  }

  static double distanceInMeters(
    double lat1,
    double lon1,
    double lat2,
    double lon2,
  ) {
    const R = 6371000;
    final dLat = _degToRad(lat2 - lat1);
    final dLon = _degToRad(lon2 - lon1);
    final a =
        sin(dLat / 2) * sin(dLat / 2) +
        cos(_degToRad(lat1)) *
            cos(_degToRad(lat2)) *
            sin(dLon / 2) *
            sin(dLon / 2);
    final c = 2 * atan2(sqrt(a), sqrt(1 - a));
    return R * c;
  }

  static double _degToRad(double deg) => deg * pi / 180;
}
```

 

```dart
import 'package:flutter/material.dart';

class CustomButton extends StatelessWidget {
  final String text;
  final VoidCallback onPressed;
  final bool filled;
  const CustomButton({
    super.key,
    required this.text,
    required this.onPressed,
    this.filled = true,
  });

  @override
  Widget build(BuildContext context) {
    return ElevatedButton(
      onPressed: onPressed,
      style: filled
          ? ElevatedButton.styleFrom(
              backgroundColor: Colors.deepOrange,
              minimumSize: const Size.fromHeight(48),
              shape: RoundedRectangleBorder(
                borderRadius: BorderRadius.circular(12),
              ),
            )
          : ElevatedButton.styleFrom(
              backgroundColor: Colors.transparent,
              foregroundColor: Colors.deepOrange,
              side: const BorderSide(color: Colors.deepOrange),
              minimumSize: const Size.fromHeight(48),
              shape: RoundedRectangleBorder(
                borderRadius: BorderRadius.circular(12),
              ),
            ),
      child: Text(text, style: const TextStyle(fontSize: 16)),
    );
  }
}
```

 

```dart
import 'package:flutter/material.dart';
import 'pages/login_page.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  runApp(const AbsensiApp());
}

class AbsensiApp extends StatelessWidget {
  const AbsensiApp({super.key});

  @override
  Widget build(BuildContext context) {
    return MaterialApp(
      title: 'Absensi Guru',
      theme: ThemeData(
        primarySwatch: Colors.deepOrange,
        scaffoldBackgroundColor: Colors.grey.shade100,
        useMaterial3: true,
      ),
      debugShowCheckedModeBanner: false,
      home: const LoginPage(),
    );
  }
}
```

 
Jadi kamu bisa edit agar menarik dan bagus sama systemnya agar pas gitu sama tambahkan berberapa feature juga
 
terutama bagian admin jadi saat admin login langsung masuk ke dashboard adminya dan banyak informasi juga
 
 
|intinya nanti ada profile setiap gyry dan admin bisa klick lalu muncul informasi dan absensi gitu jadi kalau ada guru absensi nanti bakal kayak ada notif bintik hijau tau kan
 
intinya kamu bisa edit semuanya agar pas dan ui ux nya yang menarik btw aku mau warna hijau manca